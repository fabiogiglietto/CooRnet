---
title: An R Markdown document converted from "./tmp/test_coor_interval.ipynb"
output: html_document
---

```{python}
import pandas as pd
pd.options.mode.chained_assignment = None
import numpy as np
```

```{python}
# Import ct_shares_marked as df
df = pd.read_csv('ct_shares_marked.csv')
```

```{python}
# Show the coordination interval in seconds
coor_interval = 39
print('The Coornet estimated confidence interval is ' f'{coor_interval}' ' seconds.')
```

```{python}
# Coordinated shares marked in 'ct_shares_marked.csv'
coordinated = df[df['is_coordinated'] == True]
coor_ratio = len(coordinated)/(len(df))
print('Coornet estimates that ' f'{len(coordinated)}'' out of ' f'{len(df)}'' shares are coordinated. ' f'{coor_ratio}' ' coordination ratio.')
```

```{python}
# For each article shared, sort the dataframe chronologically (ascending)
df = df.sort_values(by=['expanded', 'date']).reset_index(drop=True)
df.date = pd.to_datetime(df.date)

# Get the interval representing the difference between an entry and the following entry
df['interval'] = df.groupby('expanded')['date'].transform(lambda x: x.diff()/np.timedelta64(1, 's'))

# If the difference between 2 entries is greater than the coordination interval, assign both rows ‘coor == True’.  
# Otherwise, assign ’coor == False’.
df['coor'] = ''
for i, row in df.interval.iteritems():
    if df.loc[i, 'interval'] < coor_interval:
        df['coor'].loc[i] = True
        df['coor'].loc[i-1] = True
    else:
        df['coor'].loc[i] = False

# Print the number of coordinated shares
coordinated = df[df['coor'] == True]
coor_ratio = len(coordinated)/(len(df))
print('With the new method, coornet estimates that ' f'{len(coordinated)}'' out of ' f'{len(df)}'' shares are coordinated. ' f'{coor_ratio}' ' coordination ratio.')
```

```{python}
df.to_csv('ct_shares_marked_new.csv', index=False)
```

